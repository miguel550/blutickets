{% extends 'base.html' %}
{% load l10n %}
{% load humanize %}
{% block content %}

<form method="post" class="pt-5" action="{% url 'edit_order_and_next' %}">
  {% csrf_token %}
  <input type="hidden" name="order_id" value="{{ order.pk }}" />
  <h1>Carrito</h1>
  <table class="table table-bordered " style="width: 100%;">
    <thead class="thead-inverse">
      <tr>
        <th>Evento</th>
        <th>Tipo</th>
        <th>Precio</th>
        <th>Cantidad</th>
        <th>Total</th>
      </tr>
    </thead>
  <tbody>
    {% for line_item in line_items %}
    <tr id="li{{ line_item.pk }}">
      <td style="word-wrap: break-word;">{{ line_item.product.party_name }}</td>
        <td>
            <select class="type" name="type_{{ line_item.pk }}" required>
            {% for type in line_item.product.tickettype_set.all %}
            {% if forloop.first %}
              <option value>--Tipo--</option>
            {% endif %}
            {% if type.ttype.pk == line_item.ttype.pk %}
              <option data-priceprint="{{ type.price|unlocalize|intcomma }}" data-price="{{ type.price|unlocalize }}" value="{{ type.ttype.pk }}" selected>{{  type.ttype.name }}</option>
            {% else %}
              <option data-priceprint="{{ type.price|unlocalize|intcomma }}" data-price="{{ type.price|unlocalize }}" value="{{ type.ttype.pk }}">{{  type.ttype.name }}</option>
            {% endif %}
            {% empty %}
              <option value="no-options">General</option>
            {% endfor %}
            </select>
        </td>
        <td>
          RD$<span>{{ line_item.price|unlocalize|intcomma }}</span>
        </td>
        <td>
          <input class="quantity" data-price="{{ line_item.price|unlocalize }}" data-id="{{ forloop.counter }}" type="number" min="1" max="{{ line_item.product.remaining }}" name="quantity_{{ line_item.pk }}" style="width: 100%;" value="{{ line_item.quantity }}" />
        </td>
        <td>
          RD$<span id="total{{ forloop.counter }}">{{ line_item.total|unlocalize|intcomma }}</span>
        </td>
        <td>
          <button class="delete" data-lineitemid="{{ line_item.pk }}">
            &nbsp;<i class="fa fa-trash" aria-hidden="true"></i>
          </button>
        </td>
    </tr>
    {% empty %}
    <tr>
      <td></td>
      <td>
        No hay productos en el carrito.
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if line_items %}
<p>
  <input class="btn btn-outline-primary" id="continue" type="submit" value="Continuar" />
</p>
{% endif %}
</form>

<a class="btn btn-outline-primary" href="{% url 'home' %}">Seguir comprando</a>
{% endblock %}

{# include these in the header #}
{% block more_styles %}
<link href="//cdn.bri.io/mbox/dist/mbox-0.0.3.min.css" rel="stylesheet">
{% endblock %}

{# include these in the footer #}
{% block more_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.js"></script>
<script src="//cdn.bri.io/mbox/dist/mbox-0.0.3.min.js"></script>
<script>
const editOrder = true;
const removeItemUrl = "{% url 'remove_item_from_order' %}";
</script>
{% endblock %}